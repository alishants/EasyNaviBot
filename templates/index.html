<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Navigation Mini App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for premium look */
        body {
            background: linear-gradient(to bottom, #1a1a2e, #16213e, #0f3460);
            font-family: 'Poppins', sans-serif;
        }
        .card {
            background: linear-gradient(to top right, #2c5364, #0f2027, #203a43);
            box-shadow: 0px 10px 25px rgba(0, 0, 0, 0.6);
        }
        .btn {
            background: linear-gradient(to right, #00d2ff, #3a7bd5);
        }
        .btn:hover {
            background: linear-gradient(to right, #3a7bd5, #00d2ff);
        }
        input {
            background-color: rgba(255, 255, 255, 0.2);
        }
        input:focus {
            border-color: #00d2ff;
        }
        .history-item {
            transition: transform 0.2s ease, background-color 0.2s ease;
        }
        .history-item:hover {
            transform: scale(1.02);
            background-color: #16213e;
        }
    </style>
</head>
<body class="flex justify-center items-center min-h-screen text-white">
    <div class="card rounded-lg p-8 w-full max-w-lg relative">
        <!-- Header -->
        <header class="flex items-center justify-between mb-6">
            <h1 class="text-3xl font-bold text-cyan-400 hover:text-cyan-300 transition">
                Navigation App üöÄ
            </h1>
            <span class="text-gray-400 text-2xl cursor-pointer hover:text-cyan-400 transition" onclick="toggleHelpModal()">‚ùì</span>
        </header>

        <!-- Search Section -->
        <div class="mb-6">
            <label for="searchInput" class="block text-lg text-gray-300 mb-2">Enter a location:</label>
            <div class="relative">
                <input
                    type="text"
                    id="searchInput"
                    class="w-full px-4 py-3 text-lg text-white rounded-lg border border-gray-500 focus:ring-2 focus:outline-none"
                    placeholder="E.g., 'Central Park' or 'Gas near me'"
                />
                <span class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 cursor-pointer hover:text-cyan-400 transition" onclick="clearInput()">‚úñ</span>
            </div>
        </div>

        <!-- Buttons -->
        <div class="space-y-4">
            <button
                class="btn w-full py-3 rounded-lg text-gray-900 font-bold hover:shadow-lg transition"
                onclick="search()"
            >
                Search
            </button>
            <p
                class="text-center text-sm text-cyan-300 cursor-pointer hover:underline transition"
                onclick="showExample()"
            >
                Need ideas? Try these!
            </p>
        </div>

        <!-- History Section -->
        <section class="mt-8">
            <h3 class="text-xl font-semibold mb-4 text-gray-300">Search History</h3>
            <ul class="space-y-2" id="historyList"></ul>
        </section>
    </div>

    <!-- Modal -->
    <div
        id="helpModal"
        class="fixed inset-0 bg-gray-900 bg-opacity-90 flex justify-center items-center hidden z-50"
    >
        <div class="card rounded-lg shadow-lg p-6 max-w-sm w-full">
            <div class="flex justify-between items-center">
                <h2 class="text-2xl font-semibold text-cyan-400">Search Tips</h2>
                <button class="text-gray-400 text-lg" onclick="toggleHelpModal()">‚úñ</button>
            </div>
            <ul class="mt-4 text-gray-300 text-base space-y-2">
                <li><strong>Street:</strong> Type a street name, e.g., 'Carrer de Llull'.</li>
                <li><strong>Address:</strong> Include house numbers, e.g., 'Carrer de Llull 203'.</li>
                <li><strong>Landmark:</strong> Search for famous spots, e.g., 'Sagrada Familia'.</li>
                <li><strong>Category:</strong> Find specific places, e.g., 'Gas near me' or 'Restaurants'.</li>
            </ul>
        </div>
    </div>

    <script>
        const historyList = document.getElementById("historyList");

        function search() {
            const query = document.getElementById("searchInput").value.trim();
            if (!query) {
                alert("Please enter a location to search!");
                return;
            }

            const googleMapsUrl = generateGoogleMapsUrl(query);

            try {
                const userAgent = navigator.userAgent.toLowerCase();

                if (userAgent.includes("iphone") || userAgent.includes("ipad") || userAgent.includes("ipod")) {
                    // iOS: Direct navigation
                    window.location.href = googleMapsUrl;
                } else {
                    // Android/PC: Open in a new window
                    window.open(googleMapsUrl, "_blank");
                }
            } catch (error) {
                alert(`Couldn't open the link. Try manually: ${googleMapsUrl}`);
            }

            saveToHistory(query);
            updateHistoryList();
        }

        function generateGoogleMapsUrl(query) {
            const encodedQuery = encodeURIComponent(query.trim());
            const isAddress = /\d+/.test(query);
            const isStreet = /\b(street|avenue|road|boulevard|drive|lane|carrer|calle)\b/i.test(query);
            const isMetro = /\b(station|metro|underground|subway)\b/i.test(query) || /Sagrera|Verdaguer|Diagonal|Passeig de Gr√†cia/i.test(query);
            const isPlace = /\b(plaza|square|park|area)\b/i.test(query);

            let googleMapsUrl;

            if (isAddress || isMetro) {
                googleMapsUrl = `https://www.google.com/maps/dir/?api=1&destination=${encodedQuery}`;
            } else if (isStreet || isPlace) {
                googleMapsUrl = `https://www.google.com/maps/search/${encodedQuery}`;
            } else {
                googleMapsUrl = `https://www.google.com/maps/search/${encodedQuery}+near+me`;
            }

            return googleMapsUrl;
        }

        function saveToHistory(query) {
            const history = JSON.parse(localStorage.getItem("searchHistory") || "[]");
            if (!history.includes(query)) {
                history.unshift(query);
                if (history.length > 10) history.pop();
                localStorage.setItem("searchHistory", JSON.stringify(history));
            }
        }

        function updateHistoryList() {
            const history = JSON.parse(localStorage.getItem("searchHistory") || "[]");
            historyList.innerHTML = history
                .map(item => `<li class="history-item bg-gray-700 p-3 rounded-lg text-gray-300 cursor-pointer hover:bg-gray-600" onclick="setSearch('${item}')">${item}</li>`)
                .join("");
        }

        function setSearch(value) {
            document.getElementById("searchInput").value = value;
        }

        function toggleHelpModal() {
            const helpModal = document.getElementById("helpModal");
            helpModal.classList.toggle("hidden");
        }

        function showExample() {
            const examples = [
                "Restaurants", "Carrer", "flowers", "places", "Hotels", "Gas", "Electrical Chargers", "Coffee",
                "Parks", "Art", "Dessert", "Museum", "Electronics", "Carrer de", "Coffee shops", "Plaza Catalunya",
                "ATMs", "Pharmacies", "Tapas", "Sagrada Familia", "Metro Sagrera", "Shopping malls", "Car wash",
                "Gyms", "Bookstores", "Cafe", "Hospitals", "Clinics", "Parking lots"
            ];
            const randomExample = examples[Math.floor(Math.random() * examples.length)];
            document.getElementById("searchInput").value = randomExample;
        }

        function clearInput() {
            document.getElementById("searchInput").value = '';
        }

        updateHistoryList();
    </script>
</body>
</html>
